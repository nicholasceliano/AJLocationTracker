/*! LocationMonitor 2014-08-06 */
var express=require("express"),path=require("path"),favicon=require("static-favicon"),bodyParser=require("body-parser"),app=express(),routes=require("./routes/index"),server=require("http").Server(app),sIO=require("socket.io")(server),jsdom=require("jsdom"),$=require("jquery")(jsdom.jsdom().createWindow()),gm=require("googlemaps");gm.config({key:"AIzaSyDIUHVyHjABaBnF2h2yROpJCroqRSzZFXg"});var loadData=require("./serverCode/sLoadData"),empList=loadData.EmpDataLoad(),jobList=loadData.JobDataLoad(),businessList=loadData.BusinessDataLoad(),sMain;!function(){sIO.on("connection",function(a){var b=a.handshake.headers,c=b.referer.split(b.host)[1];switch(c){case"/":var d=loadData.BuildMarkerList(empList,jobList,businessList);sIO.emit("loadInitialMap",d),a.on("moveMarker",function(){d[0].lat=d[0].lat+.005,sIO.emit("loadUsersPosition",d[0].ID,d[0].lat,d[0].lng)});break;case"/Admin/Employees":a.on("adminEmpPageAccessed",function(){sIO.emit("passEmpInfo",empList)});break;case"/Admin/Jobs":a.on("adminJobPageAccessed",function(){sIO.emit("passJobInfo",jobList)});break;case"/Admin/Businesses":a.on("adminBusinessPageAccessed",function(){sIO.emit("passBusinessInfo",businessList)})}}),server.listen(3e3),console.log("server connected"),app.set("views",path.join(__dirname,"views")),app.set("view engine","jade"),app.use(favicon()),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(express.static(path.join(__dirname,"public"))),app.use("/",routes),app.use(function(a,b,c){var d=new Error("Not Found - 404");c(d)}),"development"===app.get("env")&&app.use(function(a,b,c){c.status(a.status||500),c.render("error",{message:a.message,error:a})}),app.use(function(a,b,c){c.status(a.status||500),c.render("error",{message:a.message,error:{}})}),module.exports=app}(sMain||(sMain={}));var jsdom=require("jsdom"),$=require("jquery")(jsdom.jsdom().createWindow()),sLoadData;!function(a){function b(){return require("../DummyData/empData.json")}function c(){return require("../DummyData/jobData.json")}function d(){return require("../DummyData/businessData.json")}function e(a,b,c){var d=Array(),e="/_release/";return $.each(a,function(a,b){var c=new f;c.ID=b.ID,c.lat=b.lat,c.lng=b.lng,c.img=e+b.img,c.name=b.fName+" "+b.lName,c.add=b.add,c.phoneNum=b.phoneNum,d.push(c)}),$.each(b,function(a,b){var c=new f;c.ID=b.ID,c.lat=b.lat,c.lng=b.lng,c.img=e+b.img,c.name=b.name,c.add=b.add,c.phoneNum=b.phoneNum,d.push(c)}),$.each(c,function(a,b){var c=new f;c.ID=b.ID,c.lat=b.lat,c.lng=b.lng,c.img=e+b.img,c.name=b.name,c.add=b.add,c.phoneNum=b.phoneNum,d.push(c)}),d}a.EmpDataLoad=b,a.JobDataLoad=c,a.BusinessDataLoad=d,a.BuildMarkerList=e;var f=function(){function a(){}return a}();a.MarkerList=f}(sLoadData||(sLoadData={})),module.exports=sLoadData;