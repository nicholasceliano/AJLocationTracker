doctype html
html
	head
		title= title
		script(type='text/javascript', src='https://maps.googleapis.com/maps/api/js?key=AIzaSyDIUHVyHjABaBnF2h2yROpJCroqRSzZFXg')
		script(type='text/javascript' src='/socket.io/socket.io.js')
		script(type='text/javascript').
			var socket = io();
			var officeLocation = { "lat": null, "lng": null};
			var map = null;
			var markers = [];
			
			socket.on('loadInitialMap', function(lat, lng){
				officeLocation.lat = lat;
				officeLocation.lng = lng;
				var mapProp = {
					center: new google.maps.LatLng(officeLocation.lat, officeLocation.lng),
					zoom:10,
					mapTypeId:google.maps.MapTypeId.ROADMAP
				};
				map=new google.maps.Map(document.getElementById("googleMap") ,mapProp);
				
				var m = new google.maps.Marker({
					id: 'Office',
					position: new google.maps.LatLng(officeLocation.lat, officeLocation.lng),
					icon: 'images/office.png'
				});
				
				markers.push(m);
				setAllMarkers();
				
				google.maps.event.addDomListener(window, 'load');
			});
			
			socket.on('loadUsersPosition', function(empID, lat, lng){
				
				for (var i = 0; i < markers.length; i++){
					if(markers[i].id == empID){
						markers[i].position = new google.maps.LatLng(lat, lng);
						setAllMarkers();
						return;
					}
				}
				
				//Only if user wasn't Found
				markers.push(new google.maps.Marker({
					id: empID,
					position: new google.maps.LatLng(lat, lng),
					icon: 'images/westside.png'}));
					
				setAllMarkers();
			});
			
			function setAllMarkers(){
				for (var i = 0; i < markers.length; i++){
					markers[i].setMap(map);
				}
			}
			
			function test(){
				setTimeout (function() {
					socket.emit('chat message', 'zzz');
					test();
				}, 5000);
			}
		link(rel='stylesheet', href='/stylesheets/style.css')
	body
		block content
		input(type='button', onclick='test();')